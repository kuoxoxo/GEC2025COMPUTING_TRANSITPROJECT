<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My C Code Portfolio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>
</head>

<body>
    <header>
        <h1>My C Programming Projects</h1>
    </header>

    <main>
        <section class="project">
            <h2>Something</h2>
            <p>HELLO WORLD</p>
        </section>

        <section class="project">
            <h2>THing</h2>
            <p>CRAZY goit</p>
        </section>

        <section class="project">
            <h2>Location & Directions</h2>
            <div id="map" style="width: 100%; height: 400px; border-radius: 8px; overflow: hidden;"></div>

            <!-- Lat/Lon display (overlay) -->
            <div id="latlon" class="map-coords">Lat: —   Lon: —</div>

            <!-- Directions controls -->
            <div id="directions-controls"
                style="margin-top:12px; background: #fff; border-radius: 8px; padding: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.06);">
                <h3>Get Directions</h3>
                <label for="startPoint">Start Point:</label>
                <input id="startPoint" type="text" placeholder="Click map or enter coords (lat,lng)"
                    style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; margin-bottom:10px;">

                <label for="endPoint">End Point:</label>
                <input id="endPoint" type="text" placeholder="Click map or enter coords (lat,lng)"
                    style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px; margin-bottom:10px;">

                <button id="getDirectionsBtn"
                    style="background: #35424a; color: #fff; border: none; padding: 8px 10px; border-radius: 6px; cursor: pointer; font-weight: 600; margin-right: 5px;">Get
                    Directions</button>
                <button id="clearDirectionsBtn"
                    style="background: #e6e6e6; color: #222; border: none; padding: 8px 10px; border-radius: 6px; cursor: pointer; font-weight: 600;">Clear</button>

                <div id="directionInfo" style="margin-top: 10px; font-size: 0.9rem; color: #333;"></div>
            </div>

            <!-- Route controls -->
            <div id="route-controls" style="margin-top:12px;">
                <label for="routeSelect">Routes:</label>
                <select id="routeSelect"></select>
                <button id="newRouteBtn">New from textarea</button>
                <button id="deleteRouteBtn">Delete</button>
                <button id="clearAllBtn">Clear All</button>
                <br /><br />
                <label for="routeColor">Color:</label>
                <input id="routeColor" type="color" value="#ff0000">
                <button id="applyColorBtn">Apply</button>
                <br /><br />
                <label for="coordsTextarea">Coordinates (one "lat,lng" per line):</label><br />
                <textarea id="coordsTextarea" rows="6" style="width:100%;"></textarea>
                <br />
                <button id="updateRouteBtn">Update Route</button>
                <button id="exportGeoJsonBtn">Export GeoJSON (console)</button>
            </div>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Center map on University of Guelph (main campus)
            const map = L.map('map').setView([43.5322, -80.2230], 15);

            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // add a marker at the campus center
            const campusMarker = L.marker([43.5322, -80.2230]).addTo(map)
                .bindPopup('University of Guelph (approx)').openPopup();

            // Directions state
            let startMarker = null;
            let endMarker = null;
            let routingControl = null;
            let pointSelectionMode = null; // 'start' or 'end'

            const startPointInput = document.getElementById('startPoint');
            const endPointInput = document.getElementById('endPoint');
            const directionInfo = document.getElementById('directionInfo');

            // storage for route objects
            const routes = {};
            const routeSelect = document.getElementById('routeSelect');
            const coordsTextarea = document.getElementById('coordsTextarea');
            const routeColor = document.getElementById('routeColor');

            // marker used when user clicks map
            let clickMarker = null;

            function addRoute(name, latlngs, color) {
                if (routes[name]) {
                    alert('Route with that name already exists.');
                    return;
                }
                const poly = L.polyline(latlngs, { color: color || '#ff0000' }).addTo(map);
                poly.bindPopup(name);
                routes[name] = { poly, color: color || '#ff0000' };
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                routeSelect.appendChild(opt);
                routeSelect.value = name;
                populateTextareaForSelected();
                fitMapToRoute(poly);
            }

            function parseCoords(text) {
                const lines = text.split(/\r?\n/).map(s => s.trim()).filter(Boolean);
                const latlngs = [];
                for (const l of lines) {
                    const parts = l.split(',').map(p => p.trim());
                    if (parts.length !== 2) continue;
                    const lat = parseFloat(parts[0]);
                    const lng = parseFloat(parts[1]);
                    if (!isNaN(lat) && !isNaN(lng)) latlngs.push([lat, lng]);
                }
                return latlngs;
            }

            function populateTextareaForSelected() {
                const name = routeSelect.value;
                if (!name || !routes[name]) { coordsTextarea.value = ''; return; }
                const latlngs = routes[name].poly.getLatLngs();
                coordsTextarea.value = latlngs.map(p => p.lat + ',' + p.lng).join('\n');
                routeColor.value = routes[name].color || '#ff0000';
            }

            function updateSelectedRoute() {
                const name = routeSelect.value;
                if (!name || !routes[name]) { alert('Select a route'); return; }
                const latlngs = parseCoords(coordsTextarea.value);
                if (latlngs.length < 2) { alert('Provide at least 2 coordinates'); return; }
                routes[name].poly.setLatLngs(latlngs);
                fitMapToRoute(routes[name].poly);
            }

            function deleteSelectedRoute() {
                const name = routeSelect.value;
                if (!name || !routes[name]) return;
                map.removeLayer(routes[name].poly);
                delete routes[name];
                for (let i = 0; i < routeSelect.options.length; i++) {
                    if (routeSelect.options[i].value === name) routeSelect.remove(i);
                }
                if (routeSelect.options.length > 0) {
                    routeSelect.selectedIndex = 0;
                    populateTextareaForSelected();
                } else {
                    coordsTextarea.value = '';
                }
            }

            function clearAllRoutes() {
                for (const name in routes) {
                    map.removeLayer(routes[name].poly);
                }
                Object.keys(routes).forEach(k => delete routes[k]);
                routeSelect.innerHTML = '';
                coordsTextarea.value = '';
            }

            function fitMapToRoute(poly) {
                try { map.fitBounds(poly.getBounds(), { padding: [20, 20] }); }
                catch (e) { }
            }

            function applyColorToSelected() {
                const name = routeSelect.value;
                if (!name || !routes[name]) { alert('Select a route'); return; }
                const color = routeColor.value;
                routes[name].poly.setStyle({ color });
                routes[name].color = color;
            }

            function exportGeoJsonSelected() {
                const name = routeSelect.value;
                if (!name || !routes[name]) { alert('Select a route'); return; }
                const gj = routes[name].poly.toGeoJSON();
                console.log(JSON.stringify(gj, null, 2));
                alert('GeoJSON printed to console.');
            }

            // Directions functions
            function setStartPoint(lat, lng) {
                if (startMarker) map.removeLayer(startMarker);
                startMarker = L.marker([lat, lng], { icon: L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] }) }).addTo(map).bindPopup('Start');
                startPointInput.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            }

            function setEndPoint(lat, lng) {
                if (endMarker) map.removeLayer(endMarker);
                endMarker = L.marker([lat, lng], { icon: L.icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png', shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png', iconSize: [25, 41], iconAnchor: [12, 41], popupAnchor: [1, -34], shadowSize: [41, 41] }) }).addTo(map).bindPopup('End');
                endPointInput.value = `${lat.toFixed(6)}, ${lng.toFixed(6)}`;
            }

            function getDirections() {
                if (!startMarker || !endMarker) {
                    alert('Please set both start and end points');
                    return;
                }

                const start = startMarker.getLatLng();
                const end = endMarker.getLatLng();

                if (routingControl) map.removeControl(routingControl);

                routingControl = L.Routing.control({
                    waypoints: [L.latLng(start.lat, start.lng), L.latLng(end.lat, end.lng)],
                    routeWhileDragging: true,
                    show: false
                }).addTo(map);

                routingControl.on('routesfound', function (e) {
                    const routes_found = e.routes;
                    const summary = routes_found[0].summary;
                    directionInfo.innerHTML = `<strong>Distance:</strong> ${(summary.totalDistance / 1000).toFixed(2)} km | <strong>Time:</strong> ${Math.round(summary.totalTime / 60)} min`;
                });
            }

            function clearDirections() {
                if (startMarker) { map.removeLayer(startMarker); startMarker = null; }
                if (endMarker) { map.removeLayer(endMarker); endMarker = null; }
                if (routingControl) { map.removeControl(routingControl); routingControl = null; }
                startPointInput.value = '';
                endPointInput.value = '';
                directionInfo.innerHTML = '';
            }

            // sample routes
            addRoute('Campus Loop A', [
                [43.5330, -80.2240],
                [43.5325, -80.2225],
                [43.5315, -80.2235],
                [43.5322, -80.2250]
            ], '#ff0000');

            addRoute('Campus Loop B', [
                [43.5328, -80.2260],
                [43.5318, -80.2250],
                [43.5308, -80.2245],
                [43.5315, -80.2230]
            ], '#0000ff');

            // wire controls
            document.getElementById('newRouteBtn').addEventListener('click', function () {
                const text = coordsTextarea.value.trim();
                if (!text) { alert('Paste coordinates into the textarea first'); return; }
                const latlngs = parseCoords(text);
                if (latlngs.length < 2) { alert('Need at least 2 coordinates'); return; }
                const name = prompt('Name for new route:', 'Route ' + (Object.keys(routes).length + 1));
                if (!name) return;
                addRoute(name, latlngs, routeColor.value);
            });
            document.getElementById('updateRouteBtn').addEventListener('click', updateSelectedRoute);
            document.getElementById('deleteRouteBtn').addEventListener('click', function () {
                if (!confirm('Delete selected route?')) return;
                deleteSelectedRoute();
            });
            document.getElementById('clearAllBtn').addEventListener('click', function () {
                if (!confirm('Clear all routes?')) return;
                clearAllRoutes();
            });
            document.getElementById('applyColorBtn').addEventListener('click', applyColorToSelected);
            document.getElementById('exportGeoJsonBtn').addEventListener('click', exportGeoJsonSelected);
            routeSelect.addEventListener('change', populateTextareaForSelected);

            // Directions button handlers
            document.getElementById('getDirectionsBtn').addEventListener('click', getDirections);
            document.getElementById('clearDirectionsBtn').addEventListener('click', clearDirections);

            // Allow clicking map to set start/end points
            startPointInput.addEventListener('click', function () {
                pointSelectionMode = 'start';
                alert('Click on the map to set start point');
            });

            endPointInput.addEventListener('click', function () {
                pointSelectionMode = 'end';
                alert('Click on the map to set end point');
            });

            map.on('click', function (e) {
                if (pointSelectionMode === 'start') {
                    setStartPoint(e.latlng.lat, e.latlng.lng);
                    pointSelectionMode = null;
                } else if (pointSelectionMode === 'end') {
                    setEndPoint(e.latlng.lat, e.latlng.lng);
                    pointSelectionMode = null;
                }
            });

            // Lat/Lon display
            const latlonDiv = document.getElementById('latlon');
            map.on('mousemove', function (e) {
                latlonDiv.textContent = `Lat: ${e.latlng.lat.toFixed(6)}   Lon: ${e.latlng.lng.toFixed(6)}`;
            });
            map.on('mouseout', function () {
                latlonDiv.textContent = 'Lat: —   Lon: —';
            });

            if (routeSelect.options.length > 0) {
                routeSelect.selectedIndex = 0;
                populateTextareaForSelected();
            }
        });
    </script>
</body>

</html>